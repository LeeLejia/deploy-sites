<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>任务操作步骤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .task-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .task-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }
        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* 移动端优化 */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            .mobile-compact-header {
                padding: 0.75rem !important;
            }
            .mobile-compact-content {
                padding: 0.75rem !important;
            }
            .mobile-compact-card {
                padding: 0.75rem !important;
                margin-bottom: 0.5rem !important;
            }
            .mobile-compact-step {
                padding: 0.625rem !important;
                margin-bottom: 0.5rem !important;
            }
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto">
        <!-- 主容器 -->
        <div class="bg-white rounded-lg shadow-2xl overflow-hidden">
            <!-- 头部 -->
            <div class="mobile-compact-header bg-gradient-to-r from-purple-600 to-indigo-600 px-4 py-4 md:px-6 md:py-5 text-white">
                <h1 id="taskTitle" class="text-2xl md:text-3xl font-bold">任务操作步骤</h1>
                <p id="taskSubtitle" class="text-purple-100 text-xs md:text-sm mt-1 md:mt-2">请按照以下步骤完成任务</p>
            </div>

            <!-- 任务列表容器 -->
            <div id="taskListContainer" class="mobile-compact-content px-4 py-4 md:px-6 md:py-6 hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4" id="taskList">
                    <!-- 任务卡片将通过 JavaScript 动态渲染 -->
                </div>
            </div>

            <!-- 步骤列表容器 -->
            <div id="stepsContainer" class="mobile-compact-content px-4 py-4 md:px-6 md:py-6">
                <!-- 步骤将通过 JavaScript 动态渲染 -->
            </div>

            <!-- 空状态提示 -->
            <div id="emptyState" class="px-4 py-8 md:px-6 md:py-12 text-center hidden">
                <svg class="w-16 h-16 md:w-20 md:h-20 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h3 class="text-lg md:text-xl font-semibold text-gray-600 mb-2">未找到任务</h3>
                <p class="text-sm md:text-base text-gray-500 mb-4">请检查 taskId 参数是否正确</p>
            </div>
        </div>

    </div>

    <script type="module">
        // 导入任务配置
        import { taskList } from './config.js';

        // 将任务列表转换为以 id 为键的对象，方便查找
        const TASKS_CONFIG = {};
        taskList.forEach(task => {
            TASKS_CONFIG[task.id] = task;
        });

        // 获取 URL 参数
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // 渲染任务列表
        function renderTaskList() {
            const container = document.getElementById('taskList');
            container.innerHTML = '';

            Object.keys(TASKS_CONFIG).forEach((taskId, index) => {
                const task = TASKS_CONFIG[taskId];
                const taskCard = document.createElement('div');
                taskCard.className = 'mobile-compact-card task-card bg-gradient-to-br from-purple-50 to-indigo-50 rounded-md p-4 md:p-5 border-2 border-purple-200';
                
                taskCard.innerHTML = `
                    <div class="flex items-start justify-between mb-2 md:mb-3">
                        <h3 class="text-base md:text-xl font-bold text-gray-800">${task.title}</h3>
                        <span class="bg-purple-600 text-white text-xs px-2 md:px-3 py-1 rounded-full flex-shrink-0 ml-2">${task.steps.length} 步</span>
                    </div>
                    <p class="text-gray-600 text-xs md:text-sm mb-3 md:mb-4">${task.description}</p>
                    <div class="flex items-center text-purple-600 font-medium text-xs md:text-sm">
                        <span>查看详情</span>
                        <svg class="w-3 h-3 md:w-4 md:h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                `;
                
                taskCard.addEventListener('click', () => {
                    window.location.href = `?taskId=${taskId}`;
                });
                
                container.appendChild(taskCard);
            });

            document.getElementById('taskListContainer').classList.remove('hidden');
            document.getElementById('stepsContainer').classList.add('hidden');
        }

        // 解析简单的 Markdown 语法
        function parseMarkdown(text) {
            // 转义 HTML 特殊字符（除了我们要处理的 Markdown 语法）
            let result = text;
            
            // 处理图片 ![alt](url) - 必须在链接之前处理，因为语法相似
            result = result.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1" class="max-w-full h-auto rounded-md my-2 md:my-3 shadow-sm" onerror="this.style.display=\'none\'" loading="lazy">');
            
            // 处理加粗 **text** 或 __text__
            result = result.replace(/\*\*(.+?)\*\*/g, '<strong class="font-bold text-gray-900">$1</strong>');
            result = result.replace(/__(.+?)__/g, '<strong class="font-bold text-gray-900">$1</strong>');
            
            // 处理超链接 [text](url)
            result = result.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-purple-600 hover:text-purple-800 underline font-medium" target="_blank" rel="noopener noreferrer">$1</a>');
            
            // 处理换行符
            result = result.replace(/\n/g, '<br>');
            
            return result;
        }

        // 渲染步骤列表
        function renderSteps(steps, taskConfig) {
            const container = document.getElementById('stepsContainer');
            container.innerHTML = '';

            // 如果任务有图片，先渲染图片
            if (taskConfig.image) {
                const imageElement = document.createElement('div');
                imageElement.className = 'mb-4 md:mb-6 -mx-4 -mt-4 md:-mx-6 md:-mt-6';
                imageElement.innerHTML = `
                    <img src="${taskConfig.image}" alt="${taskConfig.title}" class="w-full h-48 md:h-64 object-cover rounded-t-lg" onerror="this.parentElement.style.display='none'">
                `;
                container.appendChild(imageElement);
            }

            steps.forEach((step, index) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'mobile-compact-step flex items-start gap-3 md:gap-4 mb-3 md:mb-4 p-3 md:p-4 bg-gray-50 rounded-md border border-gray-200';
                
                // 解析 Markdown 语法
                const formattedStep = parseMarkdown(step);
                
                stepElement.innerHTML = `
                    <div class="flex-shrink-0 pt-0.5">
                        <div class="step-number w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center text-white font-bold text-sm md:text-base">
                            ${index + 1}
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="text-gray-800 text-sm md:text-base leading-relaxed">${formattedStep}</p>
                    </div>
                `;
                
                container.appendChild(stepElement);
            });

            document.getElementById('taskListContainer').classList.add('hidden');
            document.getElementById('stepsContainer').classList.remove('hidden');
        }

        // 显示空状态
        function showEmptyState() {
            document.getElementById('taskListContainer').classList.add('hidden');
            document.getElementById('stepsContainer').classList.add('hidden');
            document.getElementById('emptyState').classList.remove('hidden');
        }

        // 初始化页面
        function init() {
            const taskId = getQueryParam('taskId');
            
            if (!taskId) {
                // 没有 taskId 参数，显示任务列表
                document.getElementById('taskTitle').textContent = '任务列表';
                document.getElementById('taskSubtitle').textContent = '选择一个任务查看详细步骤';
                renderTaskList();
                return;
            }

            const taskConfig = TASKS_CONFIG[taskId];
            
            if (!taskConfig) {
                document.getElementById('taskTitle').textContent = '任务不存在';
                document.getElementById('taskSubtitle').textContent = '未找到对应的任务配置';
                showEmptyState();
                return;
            }

            // 设置标题和渲染步骤
            document.getElementById('taskTitle').textContent = taskConfig.title;
            document.getElementById('taskSubtitle').textContent = taskConfig.description;
            renderSteps(taskConfig.steps, taskConfig);
        }

        // 页面加载完成后初始化
        init();
    </script>
</body>
</html>


